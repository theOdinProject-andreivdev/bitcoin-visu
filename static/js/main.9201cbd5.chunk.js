(this["webpackJsonpbitcoin-visu"]=this["webpackJsonpbitcoin-visu"]||[]).push([[0],{39:function(t,e,n){},40:function(t,e,n){},62:function(t,e,n){"use strict";n.r(e);var o=n(4),c=n(0),s=n.n(c),a=n(29),r=n.n(a),i=(n(39),n(6)),u=n(2),b=(n(40),n(19)),l=n.n(b),f=n(30),h=n(31),j=n.n(h),p=function(){console.log("conn");var t=new WebSocket("wss://ws.blockchain.info/inv");return{subscribeTo:function(){var e=Object(f.a)(l.a.mark((function e(n){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.readyState===t.OPEN){e.next=12;break}return e.prev=1,e.next=4,new Promise((function(e,n){var o=0,c=setInterval((function(){o>99?(clearInterval(c),n(new Error("Maximum number of attempts exceeded"))):t.readyState===t.OPEN&&(clearInterval(c),e()),o++}),100)}));case 4:t.send(JSON.stringify({op:n})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),console.error(e.t0);case 10:e.next=13;break;case 12:t.send(JSON.stringify({op:n}));case 13:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t){return e.apply(this,arguments)}}(),startListen:function(e,n){t.onmessage=function(t){var o=JSON.parse(t.data);"utx"===o.op&&e(o.x.hash),"block"===o.op&&n(o.x.hash)}},getTxForBlock:function(t,e){j.a.get("https://blockchain.info/rawblock/"+t+"?&cors=true").then((function(t){e(t.data.tx)})).catch((function(t){console.log(t)})).then((function(){}))}}},d=n(10),O=function(t){var e=Object(c.useState)(.09*t.width),n=Object(u.a)(e,2),s=n[0],a=(n[1],Object(c.useState)(20*t.number-75)),r=Object(u.a)(a,2),i=r[0],b=(r[1],Object(c.useState)(0)),l=Object(u.a)(b,2),f=l[0],h=l[1],j=Object(c.useState)(0),p=Object(u.a)(j,2),O=p[0],m=p[1];return Object(d.b)((function(){h(f+.01),m(O+.01)})),Object(o.jsxs)("mesh",{position:[s,i,0],rotation:[f,O,0],scale:[10,10,10],children:[Object(o.jsx)("boxBufferGeometry",{args:[1,1,1]}),Object(o.jsx)("meshLambertMaterial",{color:"orange"})]})},m=function(t){var e=Object(c.useState)(-.1*t.width),n=Object(u.a)(e,2),s=n[0],a=(n[1],Object(c.useState)(Math.random()*(.1*t.height)-.1*t.height/2)),r=Object(u.a)(a,2),i=r[0],b=(r[1],Object(c.useState)(-200)),l=Object(u.a)(b,2),f=l[0],h=(l[1],Object(c.useState)(!1)),j=Object(u.a)(h,2),p=j[0],O=j[1],m=Object(c.useState)(y(.035,.055)),g=Object(u.a)(m,2),v=g[0],x=(g[1],Object(c.useRef)()),w=.002;function y(t,e){return Math.random()*(e-t)+t}return Object(d.b)((function(){if(null!==x.current)if(x.current.position.z<0&&(x.current.position.z=x.current.position.z+.1),0===t.value)x.current.position.x=x.current.position.x+y(.1,.2),x.current.position.y=x.current.position.y+y(.1,.2),x.current.position.z=x.current.position.z+.25;else{if(x.current.position.x>t.width*v||p){O(!0);var e=x.current.position.x,n=x.current.position.y;x.current.position.x=e*Math.cos(w)-n*Math.sin(w),x.current.position.y=n*Math.cos(w)+e*Math.sin(w)}x.current.position.x<t.width*v&&!1===p&&(x.current.position.x=x.current.position.x+.2)}})),Object(o.jsx)("mesh",{ref:x,position:[s,i,f],rotation:[0,0,0],scale:[1,1,1],geometry:t.geo,material:t.mat})},g=n(5),v=function(){var t=Object(c.useState)([]),e=Object(u.a)(t,2),n=e[0],s=e[1],a=Object(c.useState)([]),r=Object(u.a)(a,2),b=r[0],l=r[1],f=Object(c.useState)([]),h=Object(u.a)(f,2),j=h[0],v=h[1],x=Object(c.useState)(0),w=Object(u.a)(x,2),y=w[0],k=w[1],S=Object(c.useState)(),E=Object(u.a)(S,2),T=E[0],M=E[1],N=Object(c.useState)(new g.CircleBufferGeometry(1,10,10)),z=Object(u.a)(N,1)[0],B=Object(c.useState)(new g.MeshBasicMaterial({color:"hotpink"})),R=Object(u.a)(B,1)[0];Object(c.useEffect)((function(){M(p())}),[]);var C=Object(c.useRef)(!0);Object(c.useEffect)((function(){C.current?C.current=!1:I()}),[T]);var I=function(){console.log("Init"),"WebSocket"in window?(T.subscribeTo("unconfirmed_sub"),T.subscribeTo("blocks_sub"),T.startListen(L,J)):alert("WebSocket NOT supported by your Browser!")},J=function(t){new Audio("http://codeskulptor-demos.commondatastorage.googleapis.com/GalaxyInvaders/bonus.wav").play(),j.size>5&&v([]),v([].concat(Object(i.a)(j),[{hash:t}])),setTimeout((function(){T.getTxForBlock(t,W)}),3e3)},L=function(t){new Audio("https://commondatastorage.googleapis.com/codeskulptor-assets/week7-brrring.m4a").play();var e=!1;n.forEach((function(n){n.hash===t&&(e=!0)})),!1===e&&s((function(e){return[].concat(Object(i.a)(e),[{hash:t,value:1}])}))},W=function(t){l(t)};Object(c.useEffect)((function(){if(console.log("effect"),0!==b.length){var t=0;console.log("transactions"),console.log(n);var e=n.map((function(t){return Object.assign({},t)}));console.log("tmp transactions"),console.log(e),b.forEach((function(n){e.forEach((function(e){n.hash===e.hash&&(e.value=0,t++)}))})),console.log("tmp transactions 2"),console.log(e),l([]),s(e),k(y+t),setTimeout((function(){var t=n.map((function(t){return Object.assign({},t)}));console.log("tmp transactions"),console.log(t);for(var e=t.length-1;e>=0;e--)0===t[e].value&&t.splice(e,1);s(t)}),3e4)}}),[n]);var P=[],A=0;j.forEach((function(){P.push(A++)}));var G=document.querySelector("canvas");return Object(o.jsx)("div",{className:"App",children:Object(o.jsxs)("div",{style:{display:"grid",height:"100%",gridTemplateRows:"repeat(3,auto)",gridTemplateColumns:"repeat(2,auto)"},children:[Object(o.jsxs)("div",{className:"card-body ",style:{gridColumn:"1",gridRow:"1 / span 2",fontSize:"0.75em"},children:["bitcoin-visu is a tool for live visualization of the bitcoin network transactions.",Object(o.jsx)("br",{}),"Every pink dot represents a transaction on the blockchain.",Object(o.jsx)("br",{}),"Transactions wait on screen until they are confirmed in mined blocks. Once a block appears and a transaction is confirmed, it leaves the screen.",Object(o.jsx)("br",{}),"Best seen on desktop :)"]}),Object(o.jsxs)("div",{className:"card-body",style:{gridColumn:"2",gridRow:"1"},children:["Pending transactions: ",n.length]}),Object(o.jsxs)("div",{className:"card-body",style:{gridColumn:"2",gridRow:"2"},children:["Transactions in blocks: ",y]}),Object(o.jsxs)(d.a,{className:"canvas",camera:{fov:50,position:[0,0,200]},style:{gridColumn:"1 / span 2",gridRow:"3"},children:[Object(o.jsx)("ambientLight",{}),Object(o.jsx)("pointLight",{position:[10,10,10]}),n.map((function(t){return Object(o.jsx)(m,{value:t.value,width:G.offsetWidth,height:G.offsetHeight,geo:z,mat:R},t.hash)})),P.map((function(t){return Object(o.jsx)(O,{number:t,width:G.offsetWidth,height:G.offsetHeight},t)}))]})]})})};r.a.render(Object(o.jsx)(s.a.StrictMode,{children:Object(o.jsx)(v,{})}),document.getElementById("root"))}},[[62,1,2]]]);
//# sourceMappingURL=main.9201cbd5.chunk.js.map